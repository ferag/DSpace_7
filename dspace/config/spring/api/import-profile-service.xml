<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"
       default-lazy-init="true">

    <bean id="importResearcherProfile" class="org.dspace.app.profile.ImportResearcherProfileServiceImpl">
        <constructor-arg name="externalDataService" ref="importProfileExternalDataService"/>
        <constructor-arg name="installItemService" ref="org.dspace.content.InstallItemServiceImpl"/>
        <constructor-arg name="requestService" ref="org.dspace.services.RequestService"/>

        <property name="afterImportActionList">
            <list>
                <ref bean="dspaceAfterImportAction"/>
                <ref bean="profileItemCloningAction"/>
                <ref bean="setOrcidAndDniAction"/>
                <ref bean="updateSolrDocuments"/>
            </list>
        </property>
        <property name="importProfileProviders">
            <list>
                <ref bean="researcherProfileDspaceProvider"/>
                <ref bean="researcherProfileReniecProvider"/>
                <ref bean="researcherProfileOrcidProvider"/>
                <ref bean="researcherProfileCtiProvider"/>
            </list>
        </property>
    </bean>

    <bean id="importProfileExternalDataService" class="org.dspace.external.service.impl.ExternalDataServiceImpl">
        <property name="externalDataProviders">
            <list>
                <ref bean="dspaceLiveImportDataProvider"/>
                <ref bean="reniecLiveImportDataProvider"/>
            </list>
        </property>
    </bean>

    <bean id="dspaceLiveImportDataProvider" class="org.dspace.external.provider.impl.LiveImportDataProvider">
        <property name="metadataSource" ref="dspaceImportService"/>
        <property name="sourceIdentifier" value="dspace"/>
        <property name="recordIdMetadata" value="dc.identifier"/>
        <property name="supportedEntityTypes">
            <list>
                <value>CvPerson</value>
            </list>
        </property>
    </bean>

    <bean id="reniecLiveImportDataProvider" class="org.dspace.external.provider.impl.LiveImportDataProvider">
        <property name="metadataSource" ref="reniecImportService"/>
        <property name="sourceIdentifier" value="reniec"/>
        <property name="recordIdMetadata" value="perucris.identifier.dni"/>
        <property name="supportedEntityTypes">
            <list>
                <value>CvPerson</value>
            </list>
        </property>
    </bean>

    <bean id="reniecImportService" class="org.dspace.importer.external.reniec.ReniecImportService"/>

    <bean id="reniecMetadataFieldMapping"
          class="org.dspace.importer.external.reniec.ReniecMetadataFieldMapping">
        <property name="identifierMetadata" value="perucris.identifier.dni"/>
    </bean>


    <!-- researcher profile import providers -->
    <bean id="researcherProfileDspaceProvider" class="org.dspace.app.profile.importproviders.impl.ResearcherProfileDspaceProvider">
        <property name="sourceIdentifier" value="dspace"/>
    </bean>

    <bean id="researcherProfileReniecProvider" class="org.dspace.app.profile.importproviders.impl.ResearcherProfileReniecProvider">
        <property name="sourceIdentifier" value="reniec"/>
    </bean>

    <bean id="researcherProfileOrcidProvider" class="org.dspace.app.profile.importproviders.impl.ResearcherProfileOrcidProvider"></bean>

    <bean id="researcherProfileCtiProvider" class="org.dspace.app.profile.importproviders.impl.ResearcherProfileCtiProvider"></bean>

    <bean id="dspaceImportService" class="org.dspace.importer.external.dspace.DSpaceImportService"/>

    <bean id="dspaceInternalMetadataFieldMapping"
          class="org.dspace.importer.external.dspace.DSpaceInternalMetadataFieldMapping">
        <property name="identifierMetadata" value="dc.identifier"/>
    </bean>

    <bean id="dspaceAfterImportAction" class="org.dspace.importer.external.dspace.DspaceAfterImportAction">

        <constructor-arg name="dSpaceItemRelationshipService" ref="dspaceItemRelationshipService"/>
    </bean>
    
    <bean id="profileItemCloningAction" class="org.dspace.importer.external.dspace.ProfileItemCloningAction" />
    <bean id="setOrcidAndDniAction" class="org.dspace.importer.external.dspace.SetOrcidAndDniAction" />
    <bean id="updateSolrDocuments" class="org.dspace.importer.external.dspace.UpdateRelatedEntitiesAction">
        <property name="discoveryKeys">
			<util:list value-type="java.lang.String">
			    <value>RELATION.Person.projects</value>
			    <value>RELATION.Person.patents</value>
			    <value>RELATION.Person.researchoutputs</value>
			</util:list>
       </property>
    </bean>

    <bean id="dspaceItemRelationshipService" class="org.dspace.importer.external.dspace.DSpaceItemRelationshipService">

        <property name="leftEntityType" value="CvPerson"/>
        <property name="rightEntityType" value="Person"/>
        <property name="leftwardType" value="isPersonOwner"/>
        <property name="rightwardType" value="isOwnedByCvPerson"/>
    </bean>

    <bean id="removeRelationAction" class="org.dspace.importer.external.dspace.RemoveDSpaceRelationAction"/>
    <bean id="deleteCvEntititesAction" class="org.dspace.importer.external.dspace.DeleteCvEntititesAction"/>
    
    <util:map id="profileSynchronizationMap" map-class="java.util.HashMap" key-type="java.lang.String" value-type="java.util.List"> 
	   <entry key="perucris.cvPerson.syncEducation" >
	       <list>
	           <value>crisrp.education</value>
               <value>crisrp.education.start</value>
               <value>crisrp.education.end</value>
               <value>crisrp.education.role</value>
               <value>perucris.education.grantor</value>
               <value>perucris.education.country</value>
	       </list>
	   </entry>
	   <entry key="perucris.cvPerson.syncAffiliation" >
           <list>
               <value>oairecerif.person.affiliation</value>
               <value>oairecerif.affiliation.startDate</value>
               <value>oairecerif.affiliation.endDate</value>
               <value>oairecerif.affiliation.role</value>
           </list>
       </entry>
       <entry key="perucris.cvPerson.syncQualification" >
           <list>
               <value>crisrp.qualification</value>
               <value>crisrp.qualification.orgunit</value>
               <value>crisrp.qualification.start</value>
               <value>crisrp.qualification.end</value>
           </list>
       </entry>
       <entry key="perucris.cvPerson.syncBasicInfo" >
           <list>
		       <value>dc.title</value>
			   <value>crisrp.name</value>
			   <value>crisrp.name.translated</value>
			   <value>crisrp.name.variant</value>
			   <value>person.givenName</value>
			   <value>person.familyName</value>
			   <value>perucris.apellidoPaterno</value>
			   <value>perucris.apellidoMaterno</value>
			   <value>perucris.apellidoCasada</value>
			   <value>person.birthDate</value>
			   <value>oairecerif.person.gender</value>
			   <value>perucris.phone</value>
			   <value>perucris.mobilePhone</value>
			   <value>person.jobTitle</value>
			   <value>person.affiliation.name</value>
			   <value>crisrp.workgroup</value>
			   <value>oairecerif.identifier.url</value>
			   <value>person.email</value>
			   <value>dc.subject</value>
			   <value>perucris.subject.ocde</value>
			   <value>perucris.subject.minam</value>
			   <value>perucris.subject.ins</value>
			   <value>perucris.identifier.passport</value>
			   <value>perucris.identifier.immigrationCard</value>
			   <value>perucris.identifier.dina</value>
			   <value>perucris.identifier.renacyt</value>
			   <value>person.identifier.scopus-author-id</value>
			   <value>person.identifier.rid</value>
			   <value>perucris.domicilio.ubigeoReniec</value>
			   <value>perucris.ubigeo</value>
			   <value>perucris.address.streetAddress</value>
			   <value>perucris.address.postalCode</value>
			   <value>perucris.address.addressCountry</value>
			   <value>dc.description.abstract</value>
			   <value>crisrp.country</value>
               <value>person.knowsLanguage</value>
           </list>
       </entry>
	</util:map>

    <!-- cti database source -->

    <bean id="ctiDataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">  
        <property name="driverClassName" value="org.postgresql.Driver" />  
        <property name="url" value="${cti.db.url}" />  
        <property name="username" value="${cti.db.username}" />  
        <property name="password" value="${cti.db.password}" />  
    </bean>  
  
    <bean id="ctiJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">  
        <property name="dataSource" ref="ctiDataSource"></property>  
    </bean>  
  
    <bean id="ctiDatabaseDao" class="org.dspace.importer.external.ctidb.CtiDatabaseDaoImpl">  
        <property name="jdbcTemplate" ref="ctiJdbcTemplate"></property>  
    </bean>  

    <!-- cti data mapping strategies -->

    <bean class="org.dspace.importer.external.ctidb.mapper.CtiMappingUtilsImpl"></bean> 

    <bean class="org.dspace.importer.external.ctidb.mapper.CtiProfileMapper"></bean>

    <bean class="org.dspace.importer.external.ctidb.mapper.CtiPublicationSuggestionMapper"></bean>

    <bean class="org.dspace.importer.external.ctidb.mapper.CtiProjectSuggestionMapper"></bean>

    <bean class="org.dspace.importer.external.ctidb.mapper.CtiPatentSuggestionMapper"></bean>

    <bean class="org.dspace.importer.external.ctidb.mapper.CtiPublicationMapper"></bean> 

    <bean class="org.dspace.importer.external.ctidb.mapper.CtiProjectMapper"></bean> 

    <bean class="org.dspace.importer.external.ctidb.mapper.CtiPatentMapper"></bean> 

    <!-- cti data import facade -->

    <bean class="org.dspace.importer.external.ctidb.CtiDatabaseImportFacadeImpl"></bean> 

    <!-- cti data providers -->

    <bean class="org.dspace.importer.external.ctidb.provider.CtiPublicationDataProvider">
        <property name="sourceIdentifier" value="ctiPublication"/>
        <property name="supportedEntityTypes">
            <list>
               <value>ctiPublication</value>
            </list>
        </property>
    </bean>

    <bean class="org.dspace.importer.external.ctidb.provider.CtiProjectDataProvider">
        <property name="sourceIdentifier" value="ctiProject"/>
        <property name="supportedEntityTypes">
            <list>
               <value>ctiProject</value>
            </list>
        </property>
    </bean>

    <bean class="org.dspace.importer.external.ctidb.provider.CtiPatentDataProvider">
        <property name="sourceIdentifier" value="ctiPatent"/>
        <property name="supportedEntityTypes">
            <list>
               <value>ctiPatent</value>
            </list>
        </property>
    </bean>



    <!-- TODO: set orcid import -->
    

</beans>

